<div class="jumbotron" *ngIf="book">
  <h1 class="display-3">{{ 'PAGES.BOOK.HERO_LIST.TITLE' | translate }}</h1>
  <p class="lead" [innerHTML]="'PAGES.BOOK.HERO_LIST.DESCRIPTION' | translate"></p>
  <button type="button" class="btn btn-outline-success" (click)="openCreateHeroModal(contentHero)">{{ 'BUTTONS.HERO.CREATE_HERO' | translate }}</button>
  <hr class="my-4">

  <div class="list-group" *ngIf="book.heroes.length" cdkDropList (cdkDropListDropped)="dragDropEntities($event)">
    <div class="list-group-item list-group-item-action flex-column align-items-start" *ngFor="let hero of book.heroes" cdkDrag>
      <div class="d-flex w-100 justify-content-between">
        <h5 class="mb-1"><a routerLink="/book/{{hero.id}}" routerLinkActive="active" class="nav-link pl-0">{{hero.name}}</a></h5>
        <small>{{hero.created | date:'dd MMMM yyyy'}}</small>
      </div>

      <div *ngIf="hero.imagePreview">
        <img class="img-responsive img-width" src="{{hero.imagePreview.data}}" alt="{{hero.imagePreview.name}}" *ngIf="hero.imagePreview.data">
      </div>

      <p class="mb-1">{{hero.description | slice:0:200}} <span *ngIf="hero.description.length > 100">...</span></p>
      <small>Position: {{hero.position}}</small>

      <div cdkDragHandle>
        <img src="../../../assets/icons/drag-and-drop.png" alt="drag">
      </div>
    </div>
  </div>

  <div class="text-center text-danger" *ngIf="!book.heroes.length">{{ 'COMMON.CONTENT.EMPTY_LIST' | translate }}</div>
</div>

<ng-template #contentHero>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{ 'PAGES.BOOK.HERO_LIST.MODAL.TITLE' | translate }}</h4>
    <button type="button" class="close" aria-label="Close" (click)="closeCreateHeroModal()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <form [formGroup]="form">
      <div class="form-group">
        <label for="field-name">{{ 'COMMON.FIELDS.NAME' | translate }}</label>
        <input type="text" class="form-control" [ngClass]="{'is-valid': form.get('name').valid, 'is-invalid': form.get('name').invalid && form.get('name').touched}" id="field-name" formControlName="name" placeholder="{{ 'COMMON.FIELDS.NAME_PLACEHOLDER' | translate }}">
        <small class="form-text text-danger" *ngIf="form.get('name').invalid && form.get('name').touched">
          <span *ngIf="form.get('name').errors.required">{{ 'ERRORS.FIELDS.REQUIRED' | translate }}</span>
        </small>
      </div>

      <div class="form-group">
        <label for="field-description">{{ 'COMMON.FIELDS.DESCRIPTION' | translate }}</label>
        <textarea class="form-control" [ngClass]="{'is-valid': form.get('description').valid, 'is-invalid': form.get('description').invalid && form.get('description').touched}" id="field-description" rows="3" formControlName="description" placeholder="{{ 'COMMON.FIELDS.DESCRIPTION_PLACEHOLDER' | translate }}"></textarea>
        <small class="form-text text-danger" *ngIf="form.get('description').invalid && form.get('description').touched">
          <span *ngIf="form.get('description').errors.required">{{ 'ERRORS.FIELDS.REQUIRED' | translate }}</span>
        </small>
      </div>

      <div class="form-group">
        <label for="image-preview">Choose File</label>
        <input type="file" id="image-preview" formControlName="file" (change)="handleFileInput($event.target.files)">
        <small class="form-text text-danger" *ngIf="form.get('file').invalid && form.get('file').touched">
          <span *ngIf="form.get('file').errors.notSupportImageType"></span>
          <span *ngIf="form.get('file').errors.notSupportImageType" [translate]="'ERRORS.FIELDS.FILE_TYPE'" [translateParams]="{allowType: 'jpg, png, jpeg'}"></span>
        </small>
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button type="button" ngbAutofocus class="btn btn-outline-success" [disabled]="form.invalid" (click)="createHero()">{{ 'BUTTONS.COMMON.SAVE' | translate }}</button>
  </div>
</ng-template>
